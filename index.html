<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Local Network Server Detector</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
    h1 { color: #333; }
    #results { margin-top: 20px; }
    .found { color: green; font-weight: bold; }
    .notfound { color: #aaa; }
    .scanning { color: orange; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px 0; }
    pre { background: #fff; padding: 15px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Local Network Server Detector</h1>
  <p>This tool scans your local network for devices responding on common web ports (80, 443, 8080, etc.).</p>
  <button onclick="startScan()">Start Scanning Network</button>
  <p><strong>Your Local IP:</strong> <span id="localIP">Detecting...</span></p>

  <div id="results">
    <p><em>Click the button to begin scanning...</em></p>
  </div>

  <script>
    // Common ports used by web servers
    const COMMON_PORTS = [80, 443, 8080, 3000, 5000, 8000, 8008, 8081, 9000, 8888];

    // Get local IP using WebRTC (works in most browsers)
    function getLocalIP() {
      return new Promise((resolve) => {
        const rtc = new RTCPeerConnection({ iceServers: [] });
        rtc.createDataChannel('');
        rtc.createOffer(rtc.setLocalDescription.bind(rtc), () => {});
        rtc.onicecandidate = (e) => {
          if (!e.candidate) return;
          const ip = e.candidate.candidate.split(' ')[4];
          if (ip && ip.includes('.')) {
            rtc.close();
            resolve(ip);
          }
        };
        // Fallback if no candidate found
        setTimeout(() => {
          rtc.close();
          resolve("Unknown (WebRTC blocked)");
        }, 3000);
      });
    }

    // Try to connect to a given IP:port
    async function checkServer(ip, port, timeout = 1500) {
      return new Promise((resolve) => {
        const img = new Image();
        const timer = setTimeout(() => {
          img.src = '';
          resolve(false);
        }, timeout);

        img.onload = () => { clearTimeout(timer); resolve(true); };
        img.onerror = () => { clearTimeout(timer); resolve(true); }; // Many servers respond even on error

        // Use a random parameter to avoid caching
        img.src = `http://${ip}:${port}/?t=${Date.now()}`;
        
        // Also try HTTPS for port 443
        if (port === 443) {
          const img2 = new Image();
          img2.onload = img2.onerror = () => { clearTimeout(timer); resolve(true); };
          img2.src = `https://${ip}/?t=${Date.now()}`;
        }
      });
    }

    // Generate IPs in the same subnet
    function generateIPs(baseIP) {
      const parts = baseIP.split('.');
      const ips = [];
      for (let i = 1; i < 255; i++) {
        ips.push(`${parts[0]}.${parts[1]}.${parts[2]}.${i}`);
      }
      return ips;
    }

    async function startScan() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<p class="scanning">Scanning your local network... This may take 1-2 minutes.</p>';

      const localIP = await getLocalIP();
      document.getElementById('localIP').textContent = localIP || "Could not detect";

      if (!localIP || localIP.includes('Unknown')) {
        resultsDiv.innerHTML += '<p>Could not detect local IP. WebRTC may be blocked.</p>';
        return;
      }

      const baseNetwork = localIP.split('.').slice(0, 3).join('.');
      const ips = generateIPs(localIP);

      let found = [];

      for (const ip of ips) {
        if (ip === localIP) continue; // Skip own IP

        for (const port of COMMON_PORTS) {
          const alive = await checkServer(ip, port);
          if (alive) {
            const protocol = port === 443 ? 'https' : 'http';
            found.push(`<span class="found">FOUND → ${protocol}://${ip}:${port}</span>`);
            resultsDiv.innerHTML += `<br>✓ <strong>${protocol}://${ip}:${port}</strong> is ONLINE!`;
          }
        }
      }

      if (found.length === 0) {
        resultsDiv.innerHTML += '<p><strong>No active web servers found on common ports.</strong></p>';
        resultsDiv.innerHTML += '<p>Try checking routers, NAS, Raspberry Pi, or local dev servers (e.g., http://192.168.1.100:8080)</p>';
      } else {
        resultsDiv.innerHTML += `<p><strong>Scan complete! Found ${found.length} active service(s).</strong></p>`;
      }
    }
  </script>

  <hr>
  <small>
    <strong>Note:</strong> This tool only works on the same local WiFi/network. 
    Some devices block port scans or require authentication. 
    Works best on Chrome/Edge. Firefox may block WebRTC IP detection.
  </small>
</body>
</html>
